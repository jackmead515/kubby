apiVersion: skaffold/v4beta1
kind: Config
metadata:
  name: dask
manifests:
  helm:
    releases:
      - name: dask
        remoteChart: dask
        namespace: dask
        version: 2023.1.0
        createNamespace: false
        repo: https://helm.dask.org/
        setValues:
          scheduler.serviceType: NodePort
          worker.replicas: 4
          jupyter.enabled: false
          worker.resources:
            limits:
              cpu: 4
              memory: 4Gi
            requests:
              cpu: 4
              memory: 4Gi
          worker.custom_scheduler_url: "tcp://dask-scheduler.dask.svc.cluster.local:8786"
          worker.mounts:
            volumes:
              - name: data
                emptyDir:
                  medium: Memory
                  sizeLimit: 64Mi
            volumeMounts:
              - mountPath: /tmp/biocam
                name: data
          worker.env:
            - name: AWS_ACCESS_KEY_ID
              value: ""
            - name: AWS_SECRET_ACCESS_KEY
              value: ""
            - name: EXTRA_PIP_PACKAGES
              value: |
                dask-ml[complete]==2023.3.24 \
                opencv-python==4.7.0.72 \
                streamz==0.6.4 \
                kafka-python==2.0.2 \
                zarr==2.14.2 \
                deltalake==0.8.1 \
                s3fs \
                boto3 \
                --upgrade
deploy:
  helm: {}